(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{SocketOptions:()=>r,SocketCompletionItemProvider:()=>n});var r={reconnectionDelay:1e3,reconnectionDelayMax:6e4},n=function(){function e(e,t,r){var n=this;this.counter=0,this.signatureHelpTriggerCharacters=[],this.promiseFunctions=new Map,this.socket=e,this.standaloneEditor=t,this.editor=r,e.connect(),this.language=t.getModel()._languageIdentifier.language,this.uri=t.getModel().uri.toString(),this.initPromise=new Promise((function(e,t){n.promiseFunctions.set(n.counter,{resolve:e,reject:t,type:"capabilities"})})),e.on("init",(function(t){n.promiseFunctions.has(0)&&(t.signatureHelpProvider&&t.signatureHelpProvider.triggerCharacters&&(n.signatureHelpTriggerCharacters=t.signatureHelpProvider.triggerCharacters),t.completionProvider&&t.completionProvider.triggerCharacters&&(n.triggerCharacters=t.completionProvider.triggerCharacters),n.promiseFunctions.get(0).resolve({}),n.promiseFunctions.delete(0)),e.emit("lsp",{counter:++n.counter,method:"textDocument/didOpen",params:{textDocument:{uri:n.uri,languageId:n.language,version:n.standaloneEditor.getModel().getVersionId(),text:n.standaloneEditor.getModel().getValue()}}})})),e.on("lsp",(function(t){var r=parseInt(t.id);if(n.promiseFunctions.has(r)){var o={};switch(n.promiseFunctions.get(r).type){case"hover":o=n.createHoverResults(t);break;case"completionItems":o=n.createCompletionItemsResults(t);break;case"signatureHelp":o=n.createSignatureHelpResults(t)}n.promiseFunctions.get(r).resolve(o),n.promiseFunctions.delete(r)}"textDocument/publishDiagnostics"===t.method&&n.editor&&n.editor.setModelMarkers(n.standaloneEditor.getModel(),e.id,t.params.diagnostics.map((function(e){return e.startColumn=e.range.start.character+1,e.startLineNumber=e.range.start.line+1,e.endColumn=e.range.end.character+1,e.endLineNumber=e.range.end.line+1,delete e.range,e})))})),this.standaloneEditor.getModel().onDidChangeContent((function(){e.emit("lsp",{counter:++n.counter,method:"textDocument/didChange",params:{textDocument:{uri:n.uri,version:n.standaloneEditor.getModel().getVersionId()},contentChanges:[{text:n.standaloneEditor.getModel().getValue()}]}})}))}return e.prototype.onInitialized=function(e){return this.initPromise.then(e)},e.prototype.createHoverResults=function(e){var t={contents:[]};return e.result&&e.result.contents?(Array.isArray(e.result.contents)||(e.result.contents=[e.result.contents]),t.contents=e.result.contents.map((function(e){return"string"==typeof e?{value:e.replace("<","&lt;").replace(">","&gt;")}:{value:e.value.replace("<","&lt;").replace(">","&gt;")}})),e.result.range&&(t.range=e.result.range,e.result.range.start&&!e.result.range.startLineNumber&&(t.range.startLineNumber=e.result.range.start.line+1,t.range.startColumn=e.result.range.start.character+1),e.result.range.end&&!e.result.range.endLineNumber&&(t.range.endLineNumber=e.result.range.end.line+1,t.range.endColumn=e.result.range.end.character+1)),t):t},e.prototype.createSignatureHelpResults=function(e){return e.result.signatures&&(e.result.signatures=e.result.signatures.map((function(e){return e.parameters||(e.parameters=[]),e}))),e.result.activeParameter||(e.result.activeParameter=0),e.result.activeSignature||(e.result.activeSignature=0),{dispose:function(){},value:e.result}},e.prototype.createCompletionItemsResults=function(e){var t=[],r=!1;return Array.isArray(e.result)?t=e.result:null!==e.result&&(t=e.result.items,r=e.result.isIncomplete),{suggestions:t.map((function(e){return{additionalTextEdits:e.additionalTextEdits,command:e.command,detail:e.detail,documentation:e.documentation,filterText:e.filterText||e.label,insertText:e.insertText||e.label,insertTextRules:e.insertTextFormat,kind:e.kind,label:e.label,range:e.range,sortText:e.sortText||e.label}})),incomplete:r}},e.prototype.provideSignatureHelp=function(e,t,r,n){var o=this;return this.socket.connected?(this.socket.emit("lsp",{counter:++this.counter,method:"textDocument/signatureHelp",params:{textDocument:{uri:this.uri},position:{line:t.lineNumber-1,character:t.column-1},context:n}}),new Promise((function(e,t){o.promiseFunctions.set(o.counter,{resolve:e,reject:t,type:"signatureHelp"})}))):null},e.prototype.provideCompletionItems=function(e,t,r){var n=this;return this.socket.connected?(this.socket.emit("lsp",{counter:++this.counter,method:"textDocument/completion",params:{textDocument:{uri:this.uri},position:{line:t.lineNumber-1,character:t.column-1},context:{triggerKind:r.triggerKind}}}),new Promise((function(e,t){n.promiseFunctions.set(n.counter,{resolve:e,reject:t,type:"completionItems"})}))):null},e.prototype.provideHover=function(e,t){var r=this;return this.socket.connected?(this.socket.emit("lsp",{counter:++this.counter,method:"textDocument/hover",params:{textDocument:{uri:this.uri},position:{line:t.lineNumber-1,character:t.column-1}}}),new Promise((function(e,t){r.promiseFunctions.set(r.counter,{resolve:e,reject:t,type:"hover"})}))):null},e}();window.MonacoLSPProxy=t})();